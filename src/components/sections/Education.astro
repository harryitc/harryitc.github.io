---
import Section from "../Section.astro";
import { loadCV } from "@/utils/cvLoader";
import { Icon } from "astro-icon/components";

const CV = await loadCV();
const { education = [], certificates = [] } = CV;
---

<Section className={Astro.props.className} title="Học vấn">
  <div class="space-y-5 print:space-y-3">
    {
      education.map(({ institution, startDate, endDate, area, url }) => {
        const startYear = new Date(startDate).getFullYear();
        const endYear =
          endDate != null ? new Date(endDate).getFullYear() : "Hiện tại";
        const years = `${startYear} - ${endYear}`;

        return (
          <div class="group relative">
            <div class="flex items-start gap-4">
              <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-skin-hue/10 print:h-8 print:w-8">
                <Icon
                  name="mdi:school"
                  class="h-5 w-5 text-skin-hue print:h-4 print:w-4"
                />
              </div>
              <div class="min-w-0 flex-1">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <h3 class="text-base font-semibold text-skin-base print:text-sm">
                      {url ? (
                        <a
                          href={url}
                          target="_blank"
                          class="transition-colors hover:text-skin-hue"
                        >
                          {institution}
                        </a>
                      ) : (
                        institution
                      )}
                    </h3>
                    <p class="mt-1 text-sm text-skin-muted print:text-xs">
                      {area}
                    </p>
                  </div>
                  <time class="font-mono text-sm text-skin-muted print:text-xs">
                    {years}
                  </time>
                </div>
              </div>
            </div>
          </div>
        );
      })
    }

    {
      certificates.length > 0 && (
        <div class="mt-8 print:mt-5">
          <h4 class="mb-4 text-base font-semibold text-skin-base print:mb-3 print:text-sm">
            Chứng chỉ
          </h4>
          <div class="space-y-4 print:space-y-2">
            {certificates.map(({ name, date, issuer, url }) => {
              const certificateYear = new Date(date).getFullYear();
              return (
                <div class="group relative">
                  <div class="flex items-start gap-4">
                    <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-skin-hue/10 print:h-8 print:w-8">
                      <Icon
                        name="mdi:certificate"
                        class="h-5 w-5 text-skin-hue print:h-4 print:w-4"
                      />
                    </div>
                    <div class="min-w-0 flex-1">
                      <div class="flex items-start justify-between gap-3">
                        <div>
                          <h3 class="text-base font-semibold text-skin-base print:text-sm">
                            {url ? (
                              <a
                                href={url}
                                target="_blank"
                                class="transition-colors hover:text-skin-hue"
                              >
                                {name}
                              </a>
                            ) : (
                              name
                            )}
                          </h3>
                          <p class="mt-1 text-sm text-skin-muted print:text-xs">
                            {issuer}
                          </p>
                        </div>
                        <time class="font-mono text-sm text-skin-muted print:text-xs">
                          {certificateYear}
                        </time>
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      )
    }
  </div>
</Section>
