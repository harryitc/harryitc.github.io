---
import Section from '../Section.astro'
import SkillBadge from '../ui/SkillBadge.astro'
import { loadCV } from '@/utils/cvLoader'

const CV = await loadCV();
const { skills = [] } = CV;

// 按类别分组技能
const skillsByCategory = skills.reduce((acc: Record<string, any[]>, skill: any) => {
  const category = skill.category || '其他技术'
  if (!acc[category]) {
    acc[category] = []
  }
  acc[category].push(skill)
  return acc
}, {})

// 定义类别顺序 - 简化为5个主要类别
const categoryOrder = ['核心技术', '前端技术', '后端技术', '工具平台', '其他技术']
const sortedCategories = categoryOrder.filter(cat => skillsByCategory[cat])
---

<Section className={Astro.props.className} title='技能'>
  <div class='space-y-5 print:space-y-3'>
    {sortedCategories.map(category => (
      <div>
        <h4 class='text-sm font-medium text-skin-base mb-3 print:mb-2'>
          {category}
        </h4>
        <div class='flex flex-wrap gap-2 print:gap-1'>
          {skillsByCategory[category].map(({ name, icon, level }: any) => (
            <SkillBadge name={name} icon={icon} level={level} />
          ))}
        </div>
      </div>
    ))}
  </div>
</Section>
